#!/usr/bin/env bash
set -euo pipefail

if [ "${DOCCOMPARE_PANDOC_CHECKED:-}" = "1" ]; then
  exit 0
fi

if command -v pandoc >/dev/null 2>&1; then
  exit 0
fi

for candidate in /app/.apt/usr/bin /app/.apt/bin /app/.heroku/vendor/bin; do
  if [ -x "$candidate/pandoc" ]; then
    export PATH="$candidate:$PATH"
    DOCCOMPARE_PANDOC_CHECKED=1 exec "$0"
  fi
done

cat >&2 <<'EOF'
[warning] Pandoc was not found on the PATH. The application will fall back to
plain-text parsing, which may reduce diff fidelity.

Install Pandoc locally (https://pandoc.org/installing.html) or ensure the
heroku-community/apt buildpack is enabled with "pandoc" listed in Aptfile.
EOF

exit 0
